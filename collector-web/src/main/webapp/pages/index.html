<!DOCTYPE html>
<html lang="en">

<head>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">

<title>SB Admin 2 - Bootstrap Admin Theme</title>

<!-- Bootstrap Core CSS -->
<link href="../bower_components/bootstrap/dist/css/bootstrap.min.css"
	rel="stylesheet">

<!-- MetisMenu CSS -->
<link href="../bower_components/metisMenu/dist/metisMenu.min.css"
	rel="stylesheet">

<!-- DataTables CSS -->
<link
	href="../bower_components/datatables-plugins/integration/bootstrap/3/dataTables.bootstrap.css"
	rel="stylesheet">

<!-- DataTables Responsive CSS -->
<link
	href="../bower_components/datatables-responsive/css/dataTables.responsive.css"
	rel="stylesheet">

<!-- Custom CSS -->
<link href="../dist/css/sb-admin-2.css" rel="stylesheet">

<link href="../dist/css/dataTables.colVis.css" rel="stylesheet">

<!-- Custom Fonts -->
<link href="../bower_components/font-awesome/css/font-awesome.min.css"
	rel="stylesheet" type="text/css">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

	<div id="wrapper">

		<!-- Navigation -->
		<nav class="navbar navbar-default navbar-static-top" role="navigation"
			style="margin-bottom: 0">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse"
					data-target=".navbar-collapse">
					<span class="sr-only">Toggle navigation</span> <span
						class="icon-bar"></span> <span class="icon-bar"></span> <span
						class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="index.html">Bet Tips Collector</a>
			</div>
			<!-- /.navbar-static-side -->
		</nav>

		<div id="page-wrapper">
			<div class="row">
				<div class="col-lg-12">
					<h2 class="page-header">Dashboard</h2>
				</div>
				<!-- /.col-lg-12 -->
			</div>
			<!-- /.row -->
			<div class="row">
				<div class="col-lg-3 col-md-6">
					<div class="panel panel-primary">
						<div class="panel-heading">
							<div class="row">
								<div class="col-xs-3">
									<i class="fa fa-comments fa-5x"></i>
								</div>
								<div class="col-xs-9 text-right">
									<div class="huge">26</div>
									<div>New Comments!</div>
								</div>
							</div>
						</div>
						<a href="#">
							<div class="panel-footer">
								<span class="pull-left">View Details</span> <span
									class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
								<div class="clearfix"></div>
							</div>
						</a>
					</div>
				</div>
				<div class="col-lg-3 col-md-6">
					<div class="panel panel-green">
						<div class="panel-heading">
							<div class="row">
								<div class="col-xs-3">
									<i class="fa fa-tasks fa-5x"></i>
								</div>
								<div class="col-xs-9 text-right">
									<div class="huge">12</div>
									<div>New Tasks!</div>
								</div>
							</div>
						</div>
						<a href="#">
							<div class="panel-footer">
								<span class="pull-left">View Details</span> <span
									class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
								<div class="clearfix"></div>
							</div>
						</a>
					</div>
				</div>
				<div class="col-lg-3 col-md-6">
					<div class="panel panel-yellow">
						<div class="panel-heading">
							<div class="row">
								<div class="col-xs-3">
									<i class="fa fa-shopping-cart fa-5x"></i>
								</div>
								<div class="col-xs-9 text-right">
									<div class="huge">124</div>
									<div>New Orders!</div>
								</div>
							</div>
						</div>
						<a href="#">
							<div class="panel-footer">
								<span class="pull-left">View Details</span> <span
									class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
								<div class="clearfix"></div>
							</div>
						</a>
					</div>
				</div>
				<div class="col-lg-3 col-md-6">
					<div class="panel panel-red">
						<div class="panel-heading">
							<div class="row">
								<div class="col-xs-3">
									<i class="fa fa-support fa-5x"></i>
								</div>
								<div class="col-xs-9 text-right">
									<div class="huge">13</div>
									<div>Support Tickets!</div>
								</div>
							</div>
						</div>
						<a href="#">
							<div class="panel-footer">
								<span class="pull-left">View Details</span> <span
									class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
								<div class="clearfix"></div>
							</div>
						</a>
					</div>
				</div>
			</div>
			<!-- /.row -->
			<div class="row">
				<div class="col-lg-12">
					<div class="panel panel-default">
						<div class="panel-heading">DataTables Advanced Tables</div>
						<!-- /.panel-heading -->
						<div class="panel-body">
							<div class="dataTable_wrapper">
								<table class="table table-striped table-hover row-border"
									id="dataTables-example">
									<thead>
										<tr>
											<th>Start Date</th>
											<th>Sport</th>
											<th>Competition</th>
											<th>Event</th>
											<th>Pick</th>
											<th>Odds</th>
											<th>Tipster</th>
											<th>Result</th>
											<th>Common profit</th>
											<th>Common yield</th>
											<th>Common picks</th>
											<th>Common W-L-V</th>
											<th>Common Avg.odds</th>
											<th></th>
										</tr>
									</thead>
									<tfoot>
										<tr>
											<th></th>
											<th></th>
										</tr>
																													
									</tfoot>
								</table>
							</div>
						</div>
						<!-- /.panel-body -->
					</div>
					<!-- /.panel -->
				</div>
			</div>
			<!-- /.row -->
		</div>
		<!-- /#page-wrapper -->

	</div>
	<!-- jQuery -->
	<script src="../bower_components/jquery/dist/jquery.min.js"></script>

	<!-- Bootstrap Core JavaScript -->
	<script src="../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

	<!-- Metis Menu Plugin JavaScript -->
	<script src="../bower_components/metisMenu/dist/metisMenu.min.js"></script>

	<!-- DataTables JavaScript -->
	<script
		src="../bower_components/datatables/media/js/jquery.dataTables.js"></script>
	<script
		src="../bower_components/datatables-plugins/integration/bootstrap/3/dataTables.bootstrap.min.js"></script>

	<!-- Custom Theme JavaScript -->
	<script src="../dist/js/sb-admin-2.js"></script>
	
	<script src="../js/dataTables.colVis.js"></script>

	<!-- Page-Level Demo Scripts - Tables - Use for reference -->
	<script>
		$(document).ready(function() {
			var table = $('#dataTables-example').DataTable({
				"ajax" : window.location.protocol + "//" + window.location.host + "/collector-web/rest/prediction/all",
				"sAjaxDataProp" : "",
				"dom": 'C<"clear">lfrtip',
				"columns" : [ {
					"data" : "startDate",
					"render" : function(data, type, row) {
						// If display or filter data is requested, format the date
						if (type === 'display' || type === 'filter') {
							var d = new Date(data);
							var hours = d.getHours() > 9 ? d.getHours() : '0' + d.getHours();
							var minutes = d.getMinutes() > 9 ? d.getMinutes() : '0' + d.getMinutes();
							return d.getDate() + '-' + (d.getMonth() + 1) + '-' + d.getFullYear() + ' ' + hours + ':' + minutes;
						}

						// Otherwise the data type requested (`type`) is type detection or
						// sorting data, for which we want to use the integer, so just return
						// that, unaltered
						return data;
					}
				}, {
					"data" : "sport"
				}, {
					"data" : "competition"
				}, {
					"data" : "event"
				}, {
					"data" : "pick"
				}, {
					"data" : "odds"
				}, {
					"data" : "tipster.name"
				}, {
					"data" : "result"
				},
				{
					"data": "statistics.0.profit"
				},
				{
					"data": "statistics.0.yield"
				},
				{
					"data": "statistics.0.picks"
				},
				{
					"data": "statistics.0.winRate"
				},
				{
					"data": "statistics.0.avgOdds"
				},
	            {
	                "className":      'details-control',
	                "orderable":      false,
	                "data":           null,
	                "defaultContent": ''
	            }
				],
		        "columnDefs": [
		                     { visible: false, targets: [8,9,10,11,12] }
		                 ],
		        "colVis": {
		                     restore: "Restore",
		                     showAll: "Show all",
		                     showNone: "Show none"
		                 },
				
				"rowCallback" : function(row, data, index) {
					if (data.isCalculated == true) {
						if (data.result == 0) {
							$(row).addClass("warning");
						} else if (data.result > 0) {
							$(row).addClass("success");
						} else if (data.result < 0) {
							$(row).addClass("danger");
						}
					}
				},
				"footerCallback" : function(tfoot, data, start, end, display) {

					var totalRes = 0;
					var totalCalc = 0;
					var win = 0;
					var lose = 0;
					var _void = 0;
					for (var i = 0; i < data.length; i++) {
						if(data[i].isCalculated == true){
							totalCalc++;
							if (data[i].result == 0) {
								_void++;
							} else if (data[i].result > 0) {
								win++;
							} else if (data[i].result < 0) {
								lose++;
							}
						}
						totalRes += data[i].result;
					}

					$(tfoot).find('th').eq(0).html("Total result is " + totalRes);
					$(tfoot).find('th').eq(1).html("Total bets count is " + totalCalc + " W-L-V: " + win+"-"+lose+"-"+_void);
				}

			});
			
		    // Add event listener for opening and closing details
		    $('#dataTables-example tbody').on('click', 'td.details-control', function () {
		        var tr = $(this).closest('tr');
		        var row = table.row( tr );
		 
		        if ( row.child.isShown() ) {
		            // This row is already open - close it
		            row.child.hide();
		            tr.removeClass('shown');
		        }
		        else {
		            // Open this row
		            row.child( format(row.data()) ).show();
		            tr.addClass('shown');
		        }
		    } );
		    
		    setInterval( function () {
		        table.ajax.reload( null, false ); // user paging is not reset on reload
		    }, 30000 );
			
			
		});
		
	    
	    function format ( d ) {
	        var start = '<table class="table table-striped table-hover">'+
			'<thead>'+
				'<tr>'+
					'<th>Type</th>'+
					'<th>Profit</th>'+
					'<th>Yield</th>'+
					'<th>Picks</th>'+
					'<th>W-L-V</th>'+
					'<th>Avg.stake</th>'+
					'<th>Avg.odds</th>'+
				'</tr>'+
			'</thead>'+
			'<tbody>';
			for(var i =0; i<d.statistics.length;i++ ){
				start+= '<tr>'+
	                '<td>'+d.statistics[i].type+'</td>'+
	                '<td>'+d.statistics[i].profit+'</td>'+
	                '<td>'+d.statistics[i].yield+'</td>'+
	                '<td>'+d.statistics[i].picks+'</td>'+
	                '<td>'+d.statistics[i].win +'-'+d.statistics[i].lose+'-' +d.statistics[i].void_+'</td>'+
	                '<td>'+d.statistics[i].avgStake+'</td>'+
	                '<td>'+d.statistics[i].avgOdds+'</td>'+
	            '</tr>';
			}
	        start+='</tbody></table>';
	        return start;
	    }


	</script>
</body>

</html>
